!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e||self).corazon={})}(this,function(e){var n,t;!function(e){e[e.URGENT=2]="URGENT",e[e.IDLE=1]="IDLE"}(n||(n={})),function(e){e.PAINT="paint",e.FIRST_INPUT="first-input",e.LARGEST_CONTENTFUL_PAINT="largest-contentful-paint",e.RESOURCE="resource",e.LONGTASK="longtask",e.LAYOUT_SHIFT="layout-shift",e.ELEMENT="element",e.FIRST_PAINT="first-paint",e.FIRST_CONTENTFUL_PAINT="first-contentful-paint"}(t||(t={}));var r=window,o=document,i=window.performance,a=window.navigator,c={reportData:null,isResourceTiming:!1,captureError:!1,isPerformance:!1},s={isHidden:!1},u={FP:0,FCP:0,FID:0,LCP:0,CLS:0,TBT:0,RD:Object.create(null)},l=function(){function e(e){if(this.reportUrl=void 0,!e)throw new Error("上报地址不能为空");this.reportUrl=e}return e.prototype.sendToAnalytics=function(e,t){if(e===n.URGENT)if(fetch)fetch(this.reportUrl,{body:t,method:"POST",keepalive:!0}).catch(function(e){});else{var r=new XMLHttpRequest;r.open("POST",this.reportUrl,!0),r.setRequestHeader("Content-Type","application/json"),r.send(t),r.onerror=function(e){},r=null}else if(e===n.IDLE)if(a.sendBeacon)a.sendBeacon(this.reportUrl,t);else{var o=new Image;o.src=this.reportUrl+"?body="+t,o.onload=function(){o=null},o.onerror=function(e){}}},e}(),f=function(){return i&&!!i.getEntriesByType&&!!i.now&&!!i.mark},d=function(e){r&&Reflect.has(r,"requestidlecallback")?requestIdleCallback(e,{timeout:3e3}):e()},T=function(e,n,t){(e=parseFloat(e.toFixed(2)))>=0&&d(function(){s.isHidden&&!n.endsWith("Final")||!c.analyticsTracker||c.analyticsTracker({measureName:n,data:e,navigatorInformation:y(),vitalsScore:g(n,e)})})},p=function(e,n){d(function(){s.isHidden&&!e.endsWith("Final")||!c.analyticsTracker||c.analyticsTracker({measureName:e,data:n,navigatorInformation:y(),vitalsScore:null})})},m=function(){var e;return null!=(e=null==a?void 0:a.deviceMemory)?e:0},v=function(){var e;return null!=(e=null==a?void 0:a.hardwareConcurrency)?e:0},y=function(){return a?{deviceMemory:v(),hardwareConcurrency:m(),isLowEndDevice:!!(v()&&v()<4)||!!(m()&&m()<4),isLowEndExperience:(n=a&&(null==a||null==(e=a.connection)?void 0:e.effectiveType),!!n&&"4g"!==n)}:{};var e,n},E=[1e3,2500],h={FP:E,FCP:E,LCP:[2500,4e3],FID:[100,300],CLS:[.1,.25],TBT5S:[300,600]},g=function(e,n){return h[e]?n<=h[e][0]?"good":n>=h[e][1]?"poor":"needsImprovement":null},S=function(){function e(){if(!r||!r.addEventListener)throw new Error("不支持错误捕获!")}var t=e.prototype;return t.globalError=function(){r.onerror=function(e,t,r,o,i){var a,s=JSON.stringify({message:e,source:t,lineno:r,colno:o});return null==(a=c.reportData)||a.sendToAnalytics(n.IDLE,s),!0}},t.networkError=function(){r.addEventListener("error",function(e){var t;if(e.target!==r){var o=e.target,i=JSON.stringify({url:o.src,tag:o.tagName,message:"资源加载错误"});null==(t=c.reportData)||t.sendToAnalytics(n.IDLE,i)}},!0)},t.promiseError=function(){r.addEventListener("unhandledrejection",function(e){var t,r=JSON.stringify({message:e.reason});null==(t=c.reportData)||t.sendToAnalytics(n.IDLE,r)})},t.run=function(){this.globalError(),this.networkError(),this.promiseError()},e}();function L(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function I(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return L(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?L(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var w=Object.create(null),N=function(e,n){try{var t=new PerformanceObserver(function(e){n(e.getEntries())});return t.observe({type:e,buffered:!0}),t}catch(e){return e}},P=function(e){w[e]&&w[e].disconnect(),Reflect.deleteProperty(w,e)},F=function(e){e.forEach(function(e){e.name===t.FIRST_PAINT?(T(e.startTime,"FP"),u.FP=e.startTime):e.name===t.FIRST_CONTENTFUL_PAINT&&(T(e.startTime,"FCP"),u.FCP=e.startTime,N(t.LONGTASK,C),P(0))})},C=function(e){e.forEach(function(e){if(!("self"!==e.name||e.startTime<u.FCP)){var n=e.duration-50;n&&(u.TBT+=n)}})},R=function(e){var n=e.pop();n&&(T(n.processingStart-n.startTime,"FID"),u.FID=n.processingStart-n.startTime),P(1),u.TBT=0,setTimeout(function(){T(u.TBT,"TBT5S")},5e3)},b=function(e){var n=e.pop();n&&(u.LCP=n.renderTime,T(n.renderTime,"LCP"))},A=function(e){var n=new Map,t=u.RD;e.forEach(function(e){if(t[e.name]=e,n.has(e.initiatorType)){var r=n.get(e.initiatorType);n.set(e.initiatorType,r+e.decodedBodySize)}else n.set(e.initiatorType,e.decodedBodySize)});for(var r,o=Object.create(null),i=I(n);!(r=i()).done;){var a=r.value,c=a[0],s=a[1];t[c]=s,o[c]=s}p("Resource",o)},O=0,U=0,k=[],D=function(e){for(var n,t=I(e);!(n=t()).done;){var r=n.value;r.hadRecentInput||(U&&r.startTime-k[k.length-1].startTime<1e3&&r.startTime-k[0].startTime<5e3?(U+=r.value,k.push(r)):(U=r.value,k=[r]),U>O&&(u.CLS=O=U,T(u.CLS,"CLS")))}},_=function(e){if(this.v="1.0.0",function(e){if(!e.logUrl)throw new Error("上报地址未填写");if(c.reportData=new l(e.logUrl),e.analyticsTracker&&"function"!=typeof e.analyticsTracker)throw new Error("跟踪方法有误");c.analyticsTracker=e.analyticsTracker?e.analyticsTracker:function(e){console.log(e)},c.isResourceTiming=e.isResourceTiming||!1,c.isResourceTiming=e.isPerformance||!1,c.captureError=e.captureError||!1}(e),e.captureError){var n=new S;n&&n.run()}var u;f()&&e.isPerformance&&(r&&r.PerformanceObserver&&(w[0]=N(t.PAINT,F),w[1]=N(t.FIRST_INPUT,R),w[2]=N(t.LARGEST_CONTENTFUL_PAINT,b),c.isResourceTiming&&N(t.RESOURCE,A),w[3]=N(t.LAYOUT_SHIFT,D)),void 0!==typeof o.hidden&&o.addEventListener("visibilitychange",function(){o.hidden&&(w[2]&&P(2),w[3]&&P(3),w[4]&&P(4),s.isHidden=o.hidden)}),f()&&(u=function(){var e=i.getEntriesByType("navigation")[0];e&&p("Navigation指标",{requestTotalTime:e.responseEnd-e.requestStart,downloadTime:e.responseEnd-e.responseStart,timeToFirstByte:e.responseStart-e.startTime||0,dnsLookupTime:e.domainLookupEnd-e.domainLookupStart,tcpTime:e.connectEnd-e.connectStart,domTime:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,loadTime:e.loadEventEnd-e.startTime||0,parseDOMTime:e.domComplete-e.domInteractive||0})},"complete"===document.readyState?setTimeout(u,0):addEventListener("pageshow",u)),function(){if(a&&Reflect.has(a,"connection")){var e=a.connection;p("网络信息",{effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,downlink:e.downlink})}}())};e.Corazon=_,e.default=_});
//# sourceMappingURL=corazon.umd.js.map
