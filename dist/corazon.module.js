var e,t;!function(e){e[e.URGENT=2]="URGENT",e[e.IDLE=1]="IDLE"}(e||(e={})),function(e){e.PAINT="paint",e.FIRST_INPUT="first-input",e.LARGEST_CONTENTFUL_PAINT="largest-contentful-paint",e.RESOURCE="resource",e.LONGTASK="longtask",e.LAYOUT_SHIFT="layout-shift",e.ELEMENT="element",e.FIRST_PAINT="first-paint",e.FIRST_CONTENTFUL_PAINT="first-contentful-paint"}(t||(t={}));var r=window,n=document,o=window.performance,i=window.navigator,a={reportData:null,maxMeasureTime:15e3,isResourceTiming:!1,captureError:!1},c={isHidden:!1},s={FP:0,FCP:0,FID:0,LCP:0,CLS:0,TBT:0,RD:Object.create(null)},u=function(){function t(e){if(this.reportUrl=void 0,!e)throw new Error("上报地址不能为空");this.reportUrl=e}return t.prototype.sendToAnalytics=function(t,r){if(t===e.URGENT)if(fetch)fetch(this.reportUrl,{body:r,method:"POST",keepalive:!0}).catch(function(e){});else{var n=new XMLHttpRequest;n.open("POST",this.reportUrl,!0),n.setRequestHeader("Content-Type","application/json"),n.send(r),n.onerror=function(e){},n=null}else if(t===e.IDLE)if(i.sendBeacon)i.sendBeacon(this.reportUrl,r);else{var o=new Image;o.src=this.reportUrl+"?body="+r,o.onload=function(){o=null},o.onerror=function(e){}}},t}(),l=function(){return o&&!!o.getEntriesByType&&!!o.now&&!!o.mark},f=function(e){r&&Reflect.has(r,"requestidlecallback")?requestIdleCallback(e,{timeout:3e3}):e()},d=function(e,t,r){e=parseFloat(e.toFixed(2)),a.maxMeasureTime&&e<=a.maxMeasureTime||e>=0&&f(function(){c.isHidden&&!t.endsWith("Final")||!a.analyticsTracker||a.analyticsTracker({measureName:t,data:e,navigatorInformation:v(),vitalsScore:h(t,e)})})},T=function(e,t){f(function(){c.isHidden&&!e.endsWith("Final")||!a.analyticsTracker||a.analyticsTracker({measureName:e,data:t,navigatorInformation:v(),vitalsScore:null})})},m=function(){var e;return null!=(e=null==i?void 0:i.deviceMemory)?e:0},p=function(){var e;return null!=(e=i.hardwareConcurrency)?e:0},v=function(){return i?{deviceMemory:p(),hardwareConcurrency:m(),isLowEndDevice:!!(p()&&p()<4)||!!(m()&&m()<4),isLowEndExperience:(t=i&&(null==i||null==(e=i.connection)?void 0:e.effectiveType),!!t&&"4g"!==t)}:{};var e,t},y=[1e3,2500],E={FP:y,FCP:y,LCP:[2500,4e3],FID:[100,300],CLS:[.1,.25],TBT5S:[300,600]},h=function(e,t){return E[e]?t<=E[e][0]?"good":t>=E[e][1]?"poor":"needsImprovement":null},g=function(){function t(){if(!r||!r.addEventListener)throw new Error("不支持错误捕获!")}var n=t.prototype;return n.globalError=function(){r.onerror=function(t,r,n,o,i){var c,s=JSON.stringify({message:t,source:r,lineno:n,colno:o});return null==(c=a.reportData)||c.sendToAnalytics(e.IDLE,s),!0}},n.networkError=function(){r.addEventListener("error",function(t){var n;if(t.target!==r){var o=t.target,i=JSON.stringify({url:o.src,tag:o.tagName,message:"资源加载错误"});null==(n=a.reportData)||n.sendToAnalytics(e.IDLE,i)}},!0)},n.promiseError=function(){r.addEventListener("unhandledrejection",function(t){var r,n=JSON.stringify({message:t.reason});null==(r=a.reportData)||r.sendToAnalytics(e.IDLE,n)})},n.run=function(){this.globalError(),this.networkError(),this.promiseError()},t}();function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var L=Object.create(null),w=function(e,t){try{var r=new PerformanceObserver(function(e){t(e.getEntries())});return r.observe({type:e,buffered:!0}),r}catch(e){return null}},F=function(e){L[e]&&L[e].disconnect(),Reflect.deleteProperty(L,e)},N=function(e){e.forEach(function(e){e.name===t.FIRST_PAINT?(d(e.startTime,"FP"),s.FP=e.startTime):e.name===t.FIRST_CONTENTFUL_PAINT&&(d(e.startTime,"FCP"),s.FCP=e.startTime,w(t.LONGTASK,P),F(0))})},P=function(e){e.forEach(function(e){if(!("self"!==e.name||e.startTime<s.FCP)){var t=e.duration-50;t&&(s.TBT+=t)}})},R=function(e){var t=e.pop();t&&(d(t.processingStart-t.startTime,"FID"),s.FID=t.processingStart-t.startTime),F(1),s.TBT=0,setTimeout(function(){d(s.TBT,"TBT5S")},5e3)},C=function(e){var t=e.pop();t&&(s.LCP=t.renderTime,d(t.renderTime,"LCP"))},b=function(e){var t=new Map,r=s.RD;e.forEach(function(e){if(r[e.name]=e,t.has(e.initiatorType)){var n=t.get(e.initiatorType);t.set(e.initiatorType,n+e.decodedBodySize)}else t.set(e.initiatorType,e.decodedBodySize)});for(var n,o=Object.create(null),i=I(t);!(n=i()).done;){var a=n.value,c=a[0],u=a[1];r[c]=u,o[c]=u}T("Resource",o)},A=0,O=0,U=[],k=function(e){for(var t,r=I(e);!(t=r()).done;){var n=t.value;n.hadRecentInput||(O&&n.startTime-U[U.length-1].startTime<1e3&&n.startTime-U[0].startTime<5e3?(O+=n.value,U.push(n)):(O=n.value,U=[n]),O>A&&(s.CLS=A=O,d(s.CLS,"CLS")))}},D=function(e){if(this.v="1.0.0",function(e){if(!e.logUrl)throw new Error("上报地址未填写");if(a.reportData=new u(e.logUrl),e.analyticsTracker&&"function"!=typeof e.analyticsTracker)throw new Error("跟踪方法有误");a.analyticsTracker=e.analyticsTracker?e.analyticsTracker:function(e){console.log(e)},a.isResourceTiming=e.isResourceTiming,a.captureError=e.captureError,a.maxMeasureTime=e.maxMeasureTime}(e),e.captureError){var s=new g;s&&s.run()}var f;l()&&(r&&r.PerformanceObserver&&(L[0]=w(t.PAINT,N),L[1]=w(t.FIRST_INPUT,R),L[2]=w(t.LARGEST_CONTENTFUL_PAINT,C),a.isResourceTiming&&w(t.RESOURCE,b),L[3]=w(t.LAYOUT_SHIFT,k)),void 0!==typeof n.hidden&&n.addEventListener("visibilitychange",function(){n.hidden&&(L[2]&&F(2),L[3]&&F(3),L[4]&&F(4),c.isHidden=n.hidden)}),l()&&(f=function(){var e=o.getEntriesByType("navigation")[0];if(e){var t=e.responseStart,r=e.responseEnd;T("网站指标",{totalTime:r-e.requestStart,downloadTime:r-t,timeToFirstByte:t-e.requestStart,dnsLookupTime:e.domainLookupEnd-e.domainLookupStart||0,tcpTime:e.connectEnd-e.connectStart||0,whiteTime:t-e.startTime||0,domTime:e.domContentLoadedEventEnd-e.startTime||0,loadTime:e.loadEventEnd-e.startTime||0,parseDOMTime:e.domComplete-e.domInteractive||0})}},"complete"===document.readyState?setTimeout(f,0):addEventListener("pageshow",f)),function(){if(i&&Reflect.has(i,"connection")){var e=i.connection;T("网络信息",{effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,downlink:e.downlink})}}())};export default D;export{D as Corazon};
//# sourceMappingURL=corazon.module.js.map
