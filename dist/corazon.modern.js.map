{"version":3,"file":"corazon.modern.js","sources":["../src/types/index.ts","../src/constant/index.ts","../src/data/ReportData.ts","../src/tools/index.ts","../src/data/ErrorTrack.ts","../src/data/performance.ts","../src/data/Corazon.ts"],"sourcesContent":["import ReportData from \"../data/ReportData\";\n\n/**\n * options 配置对象\n */\nexport interface PerformanceConfig {\n    logUrl: string; // 上报地址\n    analyticsTracker?: (data: IAnalyticsTrackerOptions) => void; // 自定义报告指标的方法\n    isResourceTiming?: boolean; // 是否追踪资源加载数据\n    captureError?: boolean; // 是否开启错误跟踪\n    maxMeasureTime?: number; // 自定义捕获的最大指标时间\n}\n\nexport interface PerformanceStore {\n\n    reportData: ReportData | null,\n    maxMeasureTime?: number; // 默认15000\n    analyticsTracker?: (data: IAnalyticsTrackerOptions) => void; //追踪可以执行的方法\n    isResourceTiming?: boolean; // 是否追踪资源加载数据\n    captureError?: boolean; // 是否开启错误跟踪\n}\n\n/**\n * 优先级\n */\nexport enum Priority {\n    URGENT = 2,\n    IDLE = 1,\n}\n\nexport interface IReportData {\n    sendToAnalytics(level: Priority, body: string): void,\n}\n\n/**\n * 性能指标参数\n */\nexport type IPerformanceObserverType = 'first-input' | 'largest-contentful-paint' | 'layout-shift' | 'longtask' | 'measure' | 'navigation' | 'paint' | 'element' | 'resource' | 'longtask';\n\n\nexport enum ObserveType {\n    PAINT = 'paint',\n    FIRST_INPUT = 'first-input',\n    LARGEST_CONTENTFUL_PAINT = 'largest-contentful-paint',\n    RESOURCE = 'resource',\n    LONGTASK = 'longtask',\n    LAYOUT_SHIFT = 'layout-shift',\n    ELEMENT = 'element',\n\n    FIRST_PAINT = 'first-paint',\n    FIRST_CONTENTFUL_PAINT = 'first-contentful-paint',\n}\n\nexport interface INavigatorInfo {\n    deviceMemory?: number;\n    hardwareConcurrency?: number;\n    isLowEndDevice?: boolean;\n    isLowEndExperience?: boolean;\n    serviceWorkerStatus?: 'controlled' | 'supported' | 'unsupported';\n}\n\nexport type IVitalsScore = 'good' | 'needsImprovement' | 'poor' | null;\n\nexport interface IAnalyticsTrackerOptions {\n    measureName: string;\n    data: any;  // TODO\n    navigatorInformation: INavigatorInfo,\n    vitalsScore: IVitalsScore,\n}\n\nexport interface PerformanceEventTiming extends PerformanceEntry {\n    processingStart: DOMHighResTimeStamp;\n    processingEnd: DOMHighResTimeStamp;\n    target?: Node;\n}\n\nexport interface LargestContentfulPaint extends PerformanceEntry {\n    renderTime: DOMHighResTimeStamp;\n}\n\nexport interface CumulativeLayoutShift extends PerformanceEntry {\n    hadRecentInput: boolean;\n    value: number;\n}","import { PerformanceStore } from \"../types\";\n\nexport const W = window;\nexport const D = document;\nexport const WP = window.performance;\nexport const WN = window.navigator;\n\n// 全局的方法数据\nexport const store: PerformanceStore = {\n    reportData: null,\n    maxMeasureTime: 15000,\n    isResourceTiming: false,\n    captureError: false,\n}\n\n// 标签栏是否隐藏\nexport const visible = {\n    isHidden: false,\n}\n\n// 全局的指标数据\nexport const RData = {\n    FP: 0, // First Paint\n    FCP: 0, // First Contentful Paint\n    FID: 0, // First input delay\n    LCP: 0, \n    CLS: 0,\n    TBT:0, // Total Block Time\n    RD: Object.create(null),// resouce data\n}","import { IReportData, Priority } from \"../types\";\nimport { WN } from '../constant/index';\n\nclass ReportData implements IReportData {\n    private reportUrl: string;\n    constructor(url: string) {\n        if (!url) {\n            throw new Error(\"上报地址不能为空\");\n        }\n        this.reportUrl = url;\n    }\n\n    sendToAnalytics(level: Priority, body: string) {\n        if (level === Priority.URGENT) {\n            if (!!fetch) {\n                fetch(this.reportUrl, { body, method: 'POST', keepalive: true }).catch(reason=>{\n                    // 上报出错\n                });\n            } else {\n                let xhr: XMLHttpRequest | null = new XMLHttpRequest();\n                xhr.open('POST', this.reportUrl, true);\n                xhr.setRequestHeader('Content-Type', 'application/json');\n                xhr.send(body);\n                xhr.onerror = function (e) {\n                    // 上报出错\n                }\n                xhr = null;\n            }\n        } else if (level === Priority.IDLE) {\n            if (!!WN.sendBeacon) {\n                WN.sendBeacon(this.reportUrl, body);\n            } else {\n                let img: HTMLImageElement | null = new Image();\n                img.src = `${this.reportUrl}?body=${body}`;\n                img.onload = function () {\n                    img = null;\n                }\n                img.onerror = function (e) {\n                    // 上报出错\n                }\n            }\n        }\n    }\n}\n\nexport default ReportData;","import { PerformanceConfig, ObserveType, INavigatorInfo, IVitalsScore } from \"../types\";\nimport ReportData from \"../data/ReportData\";\nimport { WP, W, WN, store, visible } from '../constant/index';\n\nexport const validateOptions = (options: PerformanceConfig) => {\n    if (!options.logUrl) {\n        throw new Error(\"上报地址未填写\");\n    }\n\n    store.reportData = new ReportData(options.logUrl);\n\n    if (options.analyticsTracker && typeof options.analyticsTracker !== \"function\") {\n        throw new Error(\"跟踪方法有误\");\n    }\n\n    if (!options.analyticsTracker) {\n        // TODO: 参数类型补充\n        store.analyticsTracker = function (options: unknown) {\n            console.log(options);\n        }\n    } else {\n        store.analyticsTracker = options.analyticsTracker;\n    }\n\n    store.isResourceTiming = options.isResourceTiming;\n    store.captureError = options.captureError;\n    store.maxMeasureTime = options.maxMeasureTime;\n}\n\nexport const isPerformanceSupporte = () => {\n    return WP && !!WP.getEntriesByType && !!WP.now && !!WP.mark;\n}\n\nexport const isPerformanceObserverSupporte = () => {\n    return W && !!W.PerformanceObserver\n}\n\n/**  \n * 尝试使用requestIdleCallback\n */\nconst useIdleHandle = (fn: () => any) => {\n    if (W && Reflect.has(W, \"requestidlecallback\")) {\n        requestIdleCallback(fn, { timeout: 3000 })\n    } else {\n        fn();\n    }\n}\n\n/**\n * 自定义方法处理指标结论\n * @param duration 指标时间\n * @param measureName 指标名称\n */\nexport const LogConsole = (duration: number, measureName: string, customProperties?: object) => {\n    duration = parseFloat(duration.toFixed(2));\n    if (store.maxMeasureTime && duration <= store.maxMeasureTime) {\n        return;\n    }\n    if (duration >= 0) {\n        useIdleHandle(() => {\n            if (visible.isHidden && !measureName.endsWith(\"Final\") || !store.analyticsTracker) {\n                return;\n            }\n            store.analyticsTracker({ measureName, data: duration, navigatorInformation: getNavigatorInfo(), vitalsScore: getVitalsScore(measureName, duration) });\n        })\n    }\n}\n\nexport const LogObjectData = (measureName: string, customProperties?: object) => {\n    useIdleHandle(() => {\n        if (visible.isHidden && !measureName.endsWith(\"Final\") || !store.analyticsTracker) {\n            return;\n        }\n        store.analyticsTracker({ measureName, data: customProperties, navigatorInformation: getNavigatorInfo(), vitalsScore: null });\n    })\n}\n\n/**\n * 内存多大\n */\nconst getDM = () => (WN as any)?.deviceMemory ?? 0;\n/**\n * 处理器多少核\n */\nconst getHC = () => WN.hardwareConcurrency ?? 0;\n\n/**\n * 是否为低性能设备\n */\nconst getIsLowEndDevice = () => {\n    if (getHC() && getHC() < 4) {\n        return true;\n    }\n    if (getDM() && getDM() < 4) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * 网速是否差\n */\nconst getIsLowEndExperience = () => {\n    let net = WN && (WN as any)?.connection?.effectiveType;\n    return net ? net !== \"4g\" : false;\n}\n\nconst getNavigatorInfo = (): INavigatorInfo => {\n    if (WN) {\n        return {\n            deviceMemory: getHC(),\n            hardwareConcurrency: getDM(),\n            isLowEndDevice: getIsLowEndDevice(),\n            isLowEndExperience: getIsLowEndExperience(),\n        }\n    }\n    return {};\n}\n\nconst fcpScore = [1000, 2500];\nconst lcpScore = [2500, 4000];\nconst fidcore = [100, 300];\nconst clsScore = [0.1, 0.25];\nconst tbtScore = [300, 600];\n\nconst webVitalsScore: Record<string, number[]> = {\n    FP: fcpScore,\n    FCP: fcpScore,\n    LCP: lcpScore,\n    FID: fidcore,\n    CLS: clsScore,\n    TBT5S: tbtScore,\n};\n\nconst getVitalsScore = (measureName: string, value: number): IVitalsScore => {\n    if (!webVitalsScore[measureName]) {\n        return null;\n    }\n    if (value <= webVitalsScore[measureName][0]) {\n        return \"good\";\n    }\n    return value >= webVitalsScore[measureName][1] ? \"poor\" : \"needsImprovement\";\n}\n\nconst afterLoad = (callback: () => void) => {\n    if (document.readyState === 'complete') {\n        // Queue a task so the callback runs after `loadEventEnd`.\n        setTimeout(callback, 0);\n    } else {\n        // Use `pageshow` so the callback runs after `loadEventEnd`.\n        addEventListener('pageshow', callback);\n    }\n}\n\nexport const getNavigationTiming = () => {\n    if (!isPerformanceSupporte()) {\n        return;\n    }\n\n    afterLoad(() => {\n        let pnt = WP.getEntriesByType(\"navigation\")[0] as PerformanceNavigationTiming;\n        if (!pnt) {\n            return;\n        }\n        const responseStart = pnt.responseStart;\n        const responseEnd = pnt.responseEnd;\n        let data = {\n            totalTime: responseEnd - pnt.requestStart,\n            downloadTime: responseEnd - responseStart,\n            timeToFirstByte: responseStart - pnt.requestStart,\n            dnsLookupTime: pnt.domainLookupEnd - pnt.domainLookupStart || 0,\n            tcpTime: pnt.connectEnd - pnt.connectStart || 0,\n            whiteTime: responseStart - pnt.startTime || 0,\n            domTime: pnt.domContentLoadedEventEnd - pnt.startTime || 0,\n            loadTime: pnt.loadEventEnd - pnt.startTime || 0,\n            parseDOMTime: pnt.domComplete - pnt.domInteractive || 0,\n        }\n        LogObjectData(\"网站指标\", data);\n    })\n}\n\nexport const getNetworkInformation = () => {\n    if (WN && Reflect.has(WN, 'connection')) {\n        let { effectiveType, rtt, saveData, downlink } = (WN as any)['connection'];\n        LogObjectData(\"网络信息\", { effectiveType, rtt, saveData, downlink })\n    }\n}","import { W } from '../constant/index';\nimport { store } from '../constant/index';\nimport { Priority } from '../types/index';\n\nclass ErrorTrack {\n    constructor() {\n        // TODO 穿参数分类控制\n        if (!W || !W.addEventListener) {\n            throw new Error(\"不支持错误捕获!\");\n        }\n    }\n\n    private globalError() {\n        W.onerror = function (message: string | Event, source?: string, lineno?: number, colno?: number, error?: Error) {\n            let body = JSON.stringify({ message, source, lineno, colno })\n            store.reportData?.sendToAnalytics(Priority.IDLE, body);\n            return true;\n        }\n    }\n\n    private networkError() {\n        W.addEventListener(\"error\", function (e: ErrorEvent) {\n            if ((e.target as any) === W) {\n                return;\n            }\n            let ele = (e.target as HTMLImageElement | HTMLScriptElement);\n            let body = JSON.stringify({ url: ele.src, tag: ele.tagName, message: \"资源加载错误\" });\n            store.reportData?.sendToAnalytics(Priority.IDLE, body);\n        }, true)\n    }\n\n    private promiseError() {\n        W.addEventListener(\"unhandledrejection\", function (e: PromiseRejectionEvent) {\n            let body = JSON.stringify({ message: e.reason });\n            store.reportData?.sendToAnalytics(Priority.IDLE, body);\n        })\n    }\n\n    run() {\n        this.globalError();\n        this.networkError();\n        this.promiseError();\n    }\n}\n\nexport default ErrorTrack;","import { LogConsole, LogObjectData } from \"../tools\";\nimport { CumulativeLayoutShift, IPerformanceObserverType, LargestContentfulPaint, PerformanceEventTiming } from \"../types\";\nimport { ObserveType } from '../types/index';\nimport { RData, store } from '../constant/index';\n\nexport const performObserverList = Object.create(null);\n\nconst observeHandle = (eventType: IPerformanceObserverType, callback: (performanceEntries: any[]) => void): PerformanceObserver | null => {\n    try {\n        const perforObserver = new PerformanceObserver((entryList) => {\n            callback(entryList.getEntries());\n        })\n        perforObserver.observe({ type: eventType, buffered: true });\n        return perforObserver;\n    } catch (e) {\n        // 报错\n        return null;\n    }\n}\n\nconst disObserveHandle = (index: number) => {\n    if (performObserverList[index]) {\n        performObserverList[index].disconnect();\n    }\n    Reflect.deleteProperty(performObserverList, index);\n}\n\nconst paintCallback = (performanceEntries: PerformanceEntry[]) => {\n    performanceEntries.forEach((p) => {\n        if (p.name === ObserveType.FIRST_PAINT) {\n            LogConsole(p.startTime, \"FP\");\n            RData.FP = p.startTime;\n        } else if (p.name === ObserveType.FIRST_CONTENTFUL_PAINT) {\n            LogConsole(p.startTime, \"FCP\");\n            RData.FCP = p.startTime;\n            // 监听长任务，计算阻塞时常\n            observeHandle(ObserveType.LONGTASK, longTastCallback);\n            disObserveHandle(0);\n        }\n    })\n}\n\nconst longTastCallback = (performanceEntries: PerformanceEntry[]) => {\n    performanceEntries.forEach(p => {\n        // 非本浏览器上下文或首绘内容之前的不统计 https://w3c.github.io/longtasks/\n        if (p.name !== \"self\" || p.startTime < RData.FCP) {\n            return;\n        }\n        let tbt = p.duration - 50;\n        if (tbt) {\n            RData.TBT += tbt;\n        }\n    })\n}\n\nconst firstInputCallback = (performanceEventTiming: PerformanceEventTiming[]) => {\n    let last = performanceEventTiming.pop();\n    if (last) {\n        LogConsole(last.processingStart - last.startTime, \"FID\");\n        RData.FID = last.processingStart - last.startTime;\n    }\n    disObserveHandle(1);\n    // 计算FID后5s的TBT\n    RData.TBT = 0;\n    setTimeout(() => {\n        LogConsole(RData.TBT, \"TBT5S\");\n    }, 5000);\n}\n\nconst lastContentfulPaintCallback = (entryList: LargestContentfulPaint[]) => {\n    let entry = entryList.pop();\n    if (entry) {\n        RData.LCP = entry.renderTime;\n        LogConsole(entry.renderTime, \"LCP\");\n    }\n}\n\nconst resourceCallback = (performanceResources: PerformanceResourceTiming[]) => {\n    let map = new Map();\n    let total = RData.RD;\n    performanceResources.forEach(r => {\n        total[r.name] = r;\n        if (map.has(r.initiatorType)) {\n            let n = map.get(r.initiatorType);\n            map.set(r.initiatorType, n + r.decodedBodySize);\n        } else {\n            map.set(r.initiatorType, r.decodedBodySize);\n        }\n    })\n    let once = Object.create(null);\n    for (let [key, value] of map) {\n        total[key] = value;\n        once[key] = value;\n    }\n    LogObjectData(\"Resource\", once)\n}\n\nlet clsValue = 0;\nlet clsEntries: CumulativeLayoutShift[] = [];\nlet sessionValue = 0;\nlet sessionEntries: CumulativeLayoutShift[] = [];\nconst layoutshiftCallback = (performanceEntries: CumulativeLayoutShift[]) => {\n    for (let p of performanceEntries) {\n        if (!p.hadRecentInput) {\n            const firstSessionEntry = sessionEntries[0];\n            const lastSessionEntry = sessionEntries[sessionEntries.length - 1];\n            if (sessionValue &&\n                p.startTime - lastSessionEntry.startTime < 1000 &&\n                p.startTime - firstSessionEntry.startTime < 5000) {\n                sessionValue += p.value;\n                sessionEntries.push(p);\n            } else {\n                sessionValue = p.value;\n                sessionEntries = [p];\n            }\n            if (sessionValue > clsValue) {\n                clsValue = sessionValue;\n                clsEntries = sessionEntries;\n                RData.CLS = clsValue;\n                LogConsole(RData.CLS,\"CLS\");\n            }\n        }\n    }\n}\n\nexport const execPerformance = () => {\n    performObserverList[0] = observeHandle(ObserveType.PAINT, paintCallback);\n    performObserverList[1] = observeHandle(ObserveType.FIRST_INPUT, firstInputCallback);\n    performObserverList[2] = observeHandle(ObserveType.LARGEST_CONTENTFUL_PAINT, lastContentfulPaintCallback);\n    if (store.isResourceTiming) {\n        observeHandle(ObserveType.RESOURCE, resourceCallback);\n    }\n    performObserverList[3] = observeHandle(ObserveType.LAYOUT_SHIFT, layoutshiftCallback);\n}\n\nexport const removeObserver = () => {\n    if (performObserverList[2]) {\n        // LogConsole(0, \"LCPFINAL\");\n        disObserveHandle(2);\n    }\n    if (performObserverList[3]) {\n        // LogConsole(0, \"CLSFINAL\");\n        disObserveHandle(3);\n    }\n    if (performObserverList[4]) {\n        // LogConsole(0, \"TBTFINAL\");\n        disObserveHandle(4);\n    }\n}","import { PerformanceConfig } from \"../types/index\";\nimport { validateOptions, isPerformanceSupporte, isPerformanceObserverSupporte, getNavigationTiming, getNetworkInformation } from '../tools/index';\nimport ErrorTrack from './ErrorTrack';\nimport { execPerformance, removeObserver } from './performance';\nimport { D, visible } from \"../constant\";\n\nclass Corazon {\n    private v = '1.0.0';\n    constructor(options: PerformanceConfig) {\n        validateOptions(options);\n        if (options.captureError) {\n            const errorTrack = new ErrorTrack();\n            errorTrack && errorTrack.run();\n        }\n        if (!isPerformanceSupporte()) {\n            // 不支持性能监控API\n            return;\n        }\n        if (isPerformanceObserverSupporte()) {\n            execPerformance();\n        }\n        //标签页隐藏注销监听\n        if (typeof D.hidden !== undefined) {\n            D.addEventListener('visibilitychange', () => {\n                if (D.hidden) {\n                    removeObserver();\n                    visible.isHidden = D.hidden;\n                }\n            })\n        }\n        // 获取 navigation Timing 网络加载时间,白屏时间，DNS解析等指标\n        getNavigationTiming();\n        // 获取 网络信息\n        getNetworkInformation();\n    }\n}\n\nexport default Corazon;\n"],"names":["Priority","ObserveType","W","window","D","document","WP","performance","WN","navigator","store","reportData","maxMeasureTime","isResourceTiming","captureError","visible","isHidden","RData","FP","FCP","FID","LCP","CLS","TBT","RD","Object","create","ReportData","constructor","url","reportUrl","Error","this","sendToAnalytics","level","body","URGENT","fetch","method","keepalive","catch","reason","xhr","XMLHttpRequest","open","setRequestHeader","send","onerror","e","IDLE","sendBeacon","img","Image","src","onload","isPerformanceSupporte","getEntriesByType","now","mark","useIdleHandle","fn","Reflect","has","requestIdleCallback","timeout","LogConsole","duration","measureName","customProperties","parseFloat","toFixed","endsWith","analyticsTracker","data","navigatorInformation","getNavigatorInfo","vitalsScore","getVitalsScore","LogObjectData","getDM","deviceMemory","getHC","hardwareConcurrency","getIsLowEndExperience","net","connection","_WN$connection","effectiveType","isLowEndDevice","isLowEndExperience","fcpScore","webVitalsScore","TBT5S","value","ErrorTrack","addEventListener","globalError","message","source","lineno","colno","error","JSON","stringify","networkError","target","ele","tag","tagName","promiseError","run","performObserverList","observeHandle","eventType","callback","perforObserver","PerformanceObserver","entryList","getEntries","observe","type","buffered","disObserveHandle","index","disconnect","deleteProperty","paintCallback","performanceEntries","forEach","p","name","FIRST_PAINT","startTime","FIRST_CONTENTFUL_PAINT","LONGTASK","longTastCallback","tbt","firstInputCallback","performanceEventTiming","last","pop","processingStart","setTimeout","lastContentfulPaintCallback","entry","renderTime","resourceCallback","performanceResources","map","Map","total","r","initiatorType","n","get","set","decodedBodySize","once","key","clsValue","sessionValue","sessionEntries","layoutshiftCallback","hadRecentInput","firstSessionEntry","lastSessionEntry","length","push","Corazon","options","v","logUrl","console","log","validateOptions","errorTrack","PAINT","FIRST_INPUT","LARGEST_CONTENTFUL_PAINT","RESOURCE","LAYOUT_SHIFT","undefined","hidden","pnt","responseStart","responseEnd","totalTime","requestStart","downloadTime","timeToFirstByte","dnsLookupTime","domainLookupEnd","domainLookupStart","tcpTime","connectEnd","connectStart","whiteTime","domTime","domContentLoadedEventEnd","loadTime","loadEventEnd","parseDOMTime","domComplete","domInteractive","readyState","rtt","saveData","downlink","getNetworkInformation"],"mappings":"IAyBYA,EAeAC,GAfZ,SAAYD,GACRA,uBACAA,mBAFJ,CAAYA,IAAAA,OAeZ,SAAYC,GACRA,gBACAA,4BACAA,sDACAA,sBACAA,sBACAA,8BACAA,oBAEAA,4BACAA,kDAVJ,CAAYA,IAAAA,aCtCCC,EAAIC,OACJC,EAAIC,SACJC,EAAKH,OAAOI,YACZC,EAAKL,OAAOM,UAGZC,EAA0B,CACnCC,WAAY,KACZC,eAAgB,KAChBC,kBAAkB,EAClBC,cAAc,GAILC,EAAU,CACnBC,UAAU,GAIDC,EAAQ,CACjBC,GAAI,EACJC,IAAK,EACLC,IAAK,EACLC,IAAK,EACLC,IAAK,EACLC,IAAI,EACJC,GAAIC,OAAOC,OAAO,OCzBtB,MAAMC,EAEFC,YAAYC,GACR,QAFIC,kBAECD,EACD,UAAUE,MAAM,YAEpBC,KAAKF,UAAYD,EAGrBI,gBAAgBC,EAAiBC,GAC7B,GAAID,IAAUlC,EAASoC,OACnB,GAAMC,MACFA,MAAML,KAAKF,UAAW,CAAEK,KAAAA,EAAMG,OAAQ,OAAQC,WAAW,IAAQC,MAAMC,WAGpE,CACH,IAAIC,EAA6B,IAAIC,eACrCD,EAAIE,KAAK,OAAQZ,KAAKF,WAAW,GACjCY,EAAIG,iBAAiB,eAAgB,oBACrCH,EAAII,KAAKX,GACTO,EAAIK,QAAU,SAAUC,KAGxBN,EAAM,aAEHR,IAAUlC,EAASiD,KAC1B,GAAMzC,EAAG0C,WACL1C,EAAG0C,WAAWlB,KAAKF,UAAWK,OAC3B,CACH,IAAIgB,EAA+B,IAAIC,MACvCD,EAAIE,OAASrB,KAAKF,kBAAkBK,IACpCgB,EAAIG,OAAS,WACTH,EAAM,MAEVA,EAAIJ,QAAU,SAAUC,aCR3BO,EAAwB,IAC1BjD,KAAQA,EAAGkD,oBAAsBlD,EAAGmD,OAASnD,EAAGoD,KAUrDC,EAAiBC,IACf1D,GAAK2D,QAAQC,IAAI5D,EAAG,uBACpB6D,oBAAoBH,EAAI,CAAEI,QAAS,MAEnCJ,KASKK,EAAa,CAACC,EAAkBC,EAAqBC,KAC9DF,EAAWG,WAAWH,EAASI,QAAQ,IACnC5D,EAAME,gBAAkBsD,GAAYxD,EAAME,gBAG1CsD,GAAY,GACZP,EAAc,KACN5C,EAAQC,WAAamD,EAAYI,SAAS,WAAa7D,EAAM8D,kBAGjE9D,EAAM8D,iBAAiB,CAAEL,YAAAA,EAAaM,KAAMP,EAAUQ,qBAAsBC,IAAoBC,YAAaC,EAAeV,EAAaD,QAKxIY,EAAgB,CAACX,EAAqBC,KAC/CT,EAAc,KACN5C,EAAQC,WAAamD,EAAYI,SAAS,WAAa7D,EAAM8D,kBAGjE9D,EAAM8D,iBAAiB,CAAEL,YAAAA,EAAaM,KAAML,EAAkBM,qBAAsBC,IAAoBC,YAAa,UAOvHG,EAAQ,iCAAOvE,SAAAA,EAAYwE,gBAAgB,GAI3CC,EAAQ,2BAAMzE,EAAG0E,uBAAuB,GAkBxCC,EAAwB,WAC1B,IAAIC,EAAM5E,UAAOA,YAAAA,EAAY6E,mBAAZC,EAAwBC,eACzC,QAAOH,GAAc,OAARA,GAGXT,EAAmB,IACjBnE,EACO,CACHwE,aAAcC,IACdC,oBAAqBH,IACrBS,kBAtBJP,KAAWA,IAAU,OAGrBF,KAAWA,IAAU,GAoBjBU,mBAAoBN,KAGrB,GAGLO,EAAW,CAAC,IAAM,MAMlBC,EAA2C,CAC7CzE,GAAIwE,EACJvE,IAAKuE,EACLrE,IARa,CAAC,KAAM,KASpBD,IARY,CAAC,IAAK,KASlBE,IARa,CAAC,GAAK,KASnBsE,MARa,CAAC,IAAK,MAWjBf,EAAiB,CAACV,EAAqB0B,IACpCF,EAAexB,GAGhB0B,GAASF,EAAexB,GAAa,GAC9B,OAEJ0B,GAASF,EAAexB,GAAa,GAAK,OAAS,wBCzI9D,MAAM2B,EACFlE,cAEI,IAAK1B,IAAMA,EAAE6F,iBACT,UAAUhE,MAAM,YAIhBiE,cACJ9F,EAAE6C,QAAU,SAAUkD,EAAyBC,EAAiBC,EAAiBC,EAAgBC,SAC7F,IAAIlE,EAAOmE,KAAKC,UAAU,CAAEN,QAAAA,EAASC,OAAAA,EAAQC,OAAAA,EAAQC,MAAAA,IAErD,gBADA1F,EAAMC,eAAYsB,gBAAgBjC,EAASiD,KAAMd,OAKjDqE,eACJtG,EAAE6F,iBAAiB,QAAS,SAAU/C,SAClC,GAAKA,EAAEyD,SAAmBvG,EACtB,OAEJ,IAAIwG,EAAO1D,EAAEyD,OACTtE,EAAOmE,KAAKC,UAAU,CAAE1E,IAAK6E,EAAIrD,IAAKsD,IAAKD,EAAIE,QAASX,QAAS,oBACrEvF,EAAMC,eAAYsB,gBAAgBjC,EAASiD,KAAMd,KAClD,GAGC0E,eACJ3G,EAAE6F,iBAAiB,qBAAsB,SAAU/C,SAC/C,IAAIb,EAAOmE,KAAKC,UAAU,CAAEN,QAASjD,EAAEP,kBACvC/B,EAAMC,eAAYsB,gBAAgBjC,EAASiD,KAAMd,KAIzD2E,MACI9E,KAAKgE,cACLhE,KAAKwE,eACLxE,KAAK6E,sBCpCAE,EAAsBtF,OAAOC,OAAO,MAE3CsF,EAAgB,CAACC,EAAqCC,KACxD,IACI,MAAMC,EAAiB,IAAIC,oBAAqBC,IAC5CH,EAASG,EAAUC,gBAGvB,OADAH,EAAeI,QAAQ,CAAEC,KAAMP,EAAWQ,UAAU,IAC7CN,EACT,MAAOnE,GAEL,cAIF0E,EAAoBC,IAClBZ,EAAoBY,IACpBZ,EAAoBY,GAAOC,aAE/B/D,QAAQgE,eAAed,EAAqBY,IAG1CG,EAAiBC,IACnBA,EAAmBC,QAASC,IACpBA,EAAEC,OAASjI,EAAYkI,aACvBlE,EAAWgE,EAAEG,UAAW,MACxBnH,EAAMC,GAAK+G,EAAEG,WACNH,EAAEC,OAASjI,EAAYoI,yBAC9BpE,EAAWgE,EAAEG,UAAW,OACxBnH,EAAME,IAAM8G,EAAEG,UAEdpB,EAAc/G,EAAYqI,SAAUC,GACpCb,EAAiB,OAKvBa,EAAoBR,IACtBA,EAAmBC,QAAQC,IAEvB,GAAe,SAAXA,EAAEC,MAAmBD,EAAEG,UAAYnH,EAAME,IACzC,OAEJ,IAAIqH,EAAMP,EAAE/D,SAAW,GACnBsE,IACAvH,EAAMM,KAAOiH,MAKnBC,EAAsBC,IACxB,IAAIC,EAAOD,EAAuBE,MAC9BD,IACA1E,EAAW0E,EAAKE,gBAAkBF,EAAKP,UAAW,OAClDnH,EAAMG,IAAMuH,EAAKE,gBAAkBF,EAAKP,WAE5CV,EAAiB,GAEjBzG,EAAMM,IAAM,EACZuH,WAAW,KACP7E,EAAWhD,EAAMM,IAAK,UACvB,MAGDwH,EAA+B1B,IACjC,IAAI2B,EAAQ3B,EAAUuB,MAClBI,IACA/H,EAAMI,IAAM2H,EAAMC,WAClBhF,EAAW+E,EAAMC,WAAY,SAI/BC,EAAoBC,IACtB,IAAIC,EAAM,IAAIC,IACVC,EAAQrI,EAAMO,GAClB2H,EAAqBnB,QAAQuB,IAEzB,GADAD,EAAMC,EAAErB,MAAQqB,EACZH,EAAItF,IAAIyF,EAAEC,eAAgB,CAC1B,IAAIC,EAAIL,EAAIM,IAAIH,EAAEC,eAClBJ,EAAIO,IAAIJ,EAAEC,cAAeC,EAAIF,EAAEK,sBAE/BR,EAAIO,IAAIJ,EAAEC,cAAeD,EAAEK,mBAGnC,IAAIC,EAAOpI,OAAOC,OAAO,MACzB,IAAK,IAAKoI,EAAKjE,KAAUuD,EACrBE,EAAMQ,GAAOjE,EACbgE,EAAKC,GAAOjE,EAEhBf,EAAc,WAAY+E,IAG9B,IAAIE,EAAW,EAEXC,EAAe,EACfC,EAA0C,GAC9C,MAAMC,EAAuBnC,IACzB,IAAK,IAAIE,KAAKF,EACV,IAAKE,EAAEkC,eAAgB,CACnB,MAAMC,EAAoBH,EAAe,GACnCI,EAAmBJ,EAAeA,EAAeK,OAAS,GAC5DN,GACA/B,EAAEG,UAAYiC,EAAiBjC,UAAY,KAC3CH,EAAEG,UAAYgC,EAAkBhC,UAAY,KAC5C4B,GAAgB/B,EAAEpC,MAClBoE,EAAeM,KAAKtC,KAEpB+B,EAAe/B,EAAEpC,MACjBoE,EAAiB,CAAChC,IAElB+B,EAAeD,IACfA,EAAWC,EAEX/I,EAAMK,IAAMyI,EACZ9F,EAAWhD,EAAMK,IAAI,UCjHrC,MAAMkJ,EAEF5I,YAAY6I,GAER,QAHIC,EAAI,QHHgBD,CAAAA,IAC5B,IAAKA,EAAQE,OACT,UAAU5I,MAAM,WAKpB,GAFArB,EAAMC,WAAa,IAAIgB,EAAW8I,EAAQE,QAEtCF,EAAQjG,kBAAwD,mBAA7BiG,EAAQjG,iBAC3C,UAAUzC,MAAM,UAShBrB,EAAM8D,iBANLiG,EAAQjG,iBAMgBiG,EAAQjG,iBAJR,SAAUiG,GAC/BG,QAAQC,IAAIJ,IAMpB/J,EAAMG,iBAAmB4J,EAAQ5J,iBACjCH,EAAMI,aAAe2J,EAAQ3J,aAC7BJ,EAAME,eAAiB6J,EAAQ7J,gBGjB3BkK,CAAgBL,GACZA,EAAQ3J,aAAc,CACtB,MAAMiK,EAAa,IAAIjF,EACvBiF,GAAcA,EAAWjE,MH8IF,IAVhBI,EGlIN3D,MHoBFrD,GAAOA,EAAEkH,sBE4FhBL,EAAoB,GAAKC,EAAc/G,EAAY+K,MAAOlD,GAC1Df,EAAoB,GAAKC,EAAc/G,EAAYgL,YAAaxC,GAChE1B,EAAoB,GAAKC,EAAc/G,EAAYiL,yBAA0BnC,GACzErI,EAAMG,kBACNmG,EAAc/G,EAAYkL,SAAUjC,GAExCnC,EAAoB,GAAKC,EAAc/G,EAAYmL,aAAclB,SC9GrCmB,WAAbjL,EAAEkL,QACTlL,EAAE2F,iBAAiB,mBAAoB,KAC/B3F,EAAEkL,SDgHdvE,EAAoB,IAEpBW,EAAiB,GAEjBX,EAAoB,IAEpBW,EAAiB,GAEjBX,EAAoB,IAEpBW,EAAiB,GCxHL3G,EAAQC,SAAWZ,EAAEkL,UHiIhC/H,MAXU2D,EAeL,KACN,IAAIqE,EAAMjL,EAAGkD,iBAAiB,cAAc,GAC5C,IAAK+H,EACD,OAEJ,MAAMC,EAAgBD,EAAIC,cACpBC,EAAcF,EAAIE,YAYxB3G,EAAc,OAXH,CACP4G,UAAWD,EAAcF,EAAII,aAC7BC,aAAcH,EAAcD,EAC5BK,gBAAiBL,EAAgBD,EAAII,aACrCG,cAAeP,EAAIQ,gBAAkBR,EAAIS,mBAAqB,EAC9DC,QAASV,EAAIW,WAAaX,EAAIY,cAAgB,EAC9CC,UAAWZ,EAAgBD,EAAInD,WAAa,EAC5CiE,QAASd,EAAIe,yBAA2Bf,EAAInD,WAAa,EACzDmE,SAAUhB,EAAIiB,aAAejB,EAAInD,WAAa,EAC9CqE,aAAclB,EAAImB,YAAcnB,EAAIoB,gBAAkB,KA9BlC,aAAxBtM,SAASuM,WAET9D,WAAW5B,EAAU,GAGrBnB,iBAAiB,WAAYmB,IA+BA,MACjC,GAAI1G,GAAMqD,QAAQC,IAAItD,EAAI,cAAe,CACrC,IAAI+E,cAAEA,EAAFsH,IAAiBA,EAAjBC,SAAsBA,EAAtBC,SAAgCA,GAAcvM,EAAU,WAC5DsE,EAAc,OAAQ,CAAES,cAAAA,EAAesH,IAAAA,EAAKC,SAAAA,EAAUC,SAAAA,MGvJtDC"}